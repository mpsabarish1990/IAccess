<link href="../SiteAssets/iAccess/StyleSheets/package/mldicons/material-icons.css" rel="stylesheet">
<link href="../SiteAssets/iAccess/StyleSheets/bootstrap.css" rel="stylesheet" type="text/css">
<link href="../SiteAssets/iAccess/StyleSheets/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="../SiteAssets/iAccess/StyleSheets/animate.min.css" rel="stylesheet" type="text/css">
<link href="../SiteAssets/iAccess/StyleSheets/bootstrap-select.css" rel="stylesheet" type="text/css">
<link href="../SiteAssets/iAccess/StyleSheets/package/mdl/material.css" rel="stylesheet">
<link href="../SiteAssets/iAccess/fonts/font.css" rel="stylesheet">
<link href="../SiteAssets/iAccess/StyleSheets/editor.css" rel="stylesheet">
<link href="../SiteAssets/iAccess/StyleSheets/table.css" rel="stylesheet">
<link href="../SiteAssets/iAccess/StyleSheets/toastr.min.css" rel="stylesheet">
<link href="../SiteAssets/iAccess/StyleSheets/style.css" rel="stylesheet">
<link href="../SiteAssets/iAccess/StyleSheets/helper.css" rel="stylesheet">
<link href="../SiteAssets/iAccess/StyleSheets/dataTables.bootstrap.min.css" rel="stylesheet">
<link href="../SiteAssets/iAccess/StyleSheets/introjs.css" rel="stylesheet">
<link href="../SiteAssets/iAccess/StyleSheets/bootstrap-datepicker3.css" rel="stylesheet">
<link href="../SiteAssets/iAccess/StyleSheets/CheckBox.css" rel="stylesheet">
<link href="../SiteAssets/iAccess/StyleSheets/font-awesome/css/font-awesome.min.css" rel="stylesheet">
<link href="../SiteAssets/iAccess/StyleSheets/fixedHeader.dataTables.min.css" rel="stylesheet">
<link href="../SiteAssets/iAccess/StyleSheets/font-awesome/css/font-awesome.min.css" rel="stylesheet">


<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.js"></script>


<script src="../SiteAssets/iAccess/Stylesheets/package/mdl/material.min.js" type="text/javascript"></script>
<script src="../SiteAssets/iAccess/Scripts/jquery.dataTables.min.js" type="text/javascript"></script>
<script src="../SiteAssets/iAccess/Scripts/dataTables.bootstrap.min.js" type="text/javascript"></script>
<script src="../SiteAssets/iAccess/Scripts/dataTables.fixedHeader.min.js" type="text/javascript"></script>
<script src="../SiteAssets/iAccess/Scripts/spscript.js" type="text/javascript"></script>
<script src="../SiteAssets/iAccess/Scripts/toastr.min.js" type="text/javascript"></script>
<script src="../SiteAssets/iAccess/Scripts/editor.js" type="text/javascript"></script>
<script src="../SiteAssets/iAccess/Scripts/bootstrap-datepicker.min.js" type="text/javascript"></script>
<script src="../SiteAssets/iAccess/Scripts/handlebars-v4.0.5.js" type="text/javascript"></script>
<script src="../SiteAssets/iAccess/Scripts/Global.js" type="text/javascript"></script>
<script src="../SiteAssets/iAccess/Scripts/intro.js" type="text/javascript"></script>
<script src="../SiteAssets/iAccess/Scripts/date.js" type="text/javascript"></script>
<script src="../SiteAssets/iAccess/Scripts/common.js" type="text/javascript"></script>
<script src="../SiteAssets/iAccess/Scripts/camljs.js" type="text/javascript"></script>


<link type="text/css" href="../SiteAssets/iAccess/StyleSheets/bootstrap.min.css" rel="stylesheet" />

<link type="text/css" href="../SiteAssets/iAccess/StyleSheets/dataTables.bootstrap.min.css" rel="stylesheet" />


<script type="text/javascript" src="../SiteAssets/iAccess/Scripts/jquery-1.12.4.js"></script>
<script type="text/javascript" src="../SiteAssets/iAccess/Scripts/handlebars-v4.0.10.js"></script>

<script src="../SiteAssets/iAccess/Scripts/moment.min.js"></script>


<script type="text/javascript" src="../SiteAssets/iAccess/Scripts/camljs.js"></script>
<script type="text/javascript" src="../SiteAssets/iAccess/Scripts/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="../SiteAssets/iAccess/Scripts/dataTables.bootstrap.min.js"></script>


<div class="cssload-container">
    <div class="cssload-speeding-wheel">
    </div>
</div>
<div class="">

    

    <div class="mdl-cell--12-col">
        <div class="alert alert-success alert-dismissible hidden" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <strong></strong>
        </div>
        <div class="alert alert-warning alert-dismissible hidden" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <strong></strong>
        </div>
        <div class="alert alert-warning alert-dismissible hidden" role="alert" id="Div2">
            <strong></strong>
        </div>
    </div>

    <main class="mdl-layout__content">
        <h4 class="main_title"><span>View Request</span></h4>
    <div action="#" class="horizontal-form">
        <div class="mdl-grid mdl-color--white mdl-shadow--2dp">
            <div class="mdl-cell--6-col">
            	
                <div class="mdl-grid mdl-color--white">
                    <div class="mdl-cell mdl-cell--3-col">
                        <label class="" for="sample1">Request for<span style="color: red">*</span></label>
                    </div>
                    <div class="mdl-cell mdl-cell--9-col requestfor">
                        <div class="mdl-js-textfield margin-top--20" >
                            <input class="form-control" id="lbl_requestfor" readonly="readonly" value="">
                            <label class="mdl-textfield__label"  for="sample1">&nbsp;</label>
                        </div>
                    </div>
                </div>
                <div class="mdl-grid mdl-color--white">
                    <div class="mdl-cell mdl-cell--3-col">
                        <label class="" for="sample1">Employee / User-Id<span style="color: red">*</span></label>
                    </div>
                    <div class="mdl-cell mdl-cell--9-col">
                        <div class="mdl-js-textfield margin-top--20">
                            <input class="form-control" id="lbl_requesterID" readonly="readonly" value="">
                            <label class="mdl-textfield__label"  for="sample1">&nbsp;</label>
                        </div>
                    </div>
                </div>
                <div class="mdl-grid mdl-color--white">    
                    <div class="mdl-cell mdl-cell--3-col">
                        <label class="" for="sample1">Manager <span style="color: red">*</span></label>
                    </div>
                    <div class="mdl-cell mdl-cell--9-col">
                        <div class="mdl-js-textfield margin-top--20">
                            <input class="form-control" id="lbl_managerID" readonly="readonly" value="">
                            <label class="mdl-textfield__label"  for="sample1">&nbsp;</label>
                        </div>
                    </div>
                </div>    
            </div>
            <div class="mdl-cell--6-col">
                <div class="mdl-grid mdl-color--white">
                    <div class="mdl-cell mdl-cell--3-col">
                        <label class="" for="sample1">Request Details<span style="color: red">*</span></label>
                    </div>
                    <div class="mdl-cell mdl-cell--9-col">
                        <div class="mdl-js-textfield margin-top--20">
                            <input class="form-control" id="lbl_requestdetails" readonly="readonly" value="">
                            <label class="mdl-textfield__label"  for="sample1">&nbsp;</label>
                        </div>
                    </div>
                </div>
                <div class="mdl-grid mdl-color--white">    
                    <div class="mdl-cell mdl-cell--3-col">
                        <label class="" for="sample1">Request Id<span style="color: red">*</span></label>
                    </div>
                    <div class="mdl-cell mdl-cell--9-col">
                        <div class="mdl-js-textfield margin-top--20">
                            <input class="form-control" id="lbl_requestID" readonly="readonly" value="">
                            <label class="mdl-textfield__label"  for="sample1">&nbsp;</label>
                        </div>
                    </div>
                </div>    
            </div>
            <div class="mdl-cell mdl-cell--12-col ButtonAction">
                <div class="mdl-js-textfield">
                    <label id="Label5" for="submit" class="mdl-button mdl-js-button blue-bg-100"><a class="mdl-color-text--primary-contrast" href="http://devsp13:20202/sites/IssueTracker/IAccess/Pages/Dashboard.aspx">Cancel</a></label>
                </div>
            </div>
        </div>
    </div>
</main>

</div>
<!--For Confirmation Modal Window-->

<div class="modal fade" id="Div6" role="dialog" id="">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Submit Request
                </h4>
            </div>
            <div class="modal-body" style="padding: 30px;">
                <span>Are you sure do you want to proceed?</span>
            </div>
            <div class="modal-footer">
                <a type="button" style="cursor: pointer;" id="A3" class="btn btn-info">Yes</a>
                <a type="button" style="cursor: pointer;" id="A4" data-dismiss="modal" class="btn btn-default">No</a>
            </div>
        </div>
    </div>
</div>

<script>
    (function ($) {
        $.getUrlVar = function (key) {
            var result = new RegExp(key + "=([^&]*)", "i").exec(window.location.search);
            return result && unescape(result[1]) || "";
        };
    })(jQuery);
</script>

<script>

    var clientContext;
    var collListItem;
    // $.showLoader();
    var configStoreListName = "Config Store";
    var configStoreCategory = "DataTable";
    var currentUser = null;
    var keyCollection = {
        "RepositoryListName": "" // default value


    };

    var keys = Object.keys(keyCollection);
    var query = new CamlBuilder()
        .Where().TextField("Key").In(keys)
        .And().TextField("Category").EqualTo(configStoreCategory).ToString();

    var listDisplayName = "";
    var Requester_entry = "";
    var Manager_entry = "";
    var Comments_entry = "";
    var Status_entry = "";
    var RequestFor_entry = "";
    var Login_Name_entry = "";

    jQuery(document).ready(function () {


        SP.SOD.executeFunc('sp.js', 'SP.ClientContext', start_Update());



    });
    function start_Update() {
        clientContext = new SP.ClientContext(_spPageContextInfo.webAbsoluteUrl);
        web = clientContext.get_web();
        var oList = web.get_lists().getByTitle(configStoreListName);
        var camlQuery = new SP.CamlQuery();
        camlQuery.set_viewXml('<View><Query>' + query + '</Query></View>');
        collListItem = oList.getItems(camlQuery);
        currentUser = web.get_currentUser();
        clientContext.load(currentUser);
        clientContext.load(collListItem);
        clientContext.executeQueryAsync(Function.createDelegate(this, onQuerySucceeded_Update), Function.createDelegate(this, onQueryFailed_update));
    }

    function onQuerySucceeded_Update(sender, args) {
        var listItemEnumerator = collListItem.getEnumerator();
        while (listItemEnumerator.moveNext()) {
            var oListItem = listItemEnumerator.get_current();
            if (!keyCollection[oListItem.get_item('Key')]) {
                keyCollection[oListItem.get_item('Key')] = oListItem.get_item('Value');
            }
        }

        
        listDisplayName = keyCollection["RepositoryListName"];
        querystring = $.getUrlVar('Ticket_ID');

        if (querystring != "") {

            ViewFormEntry();
           
          

        }
        else {
            //alert("The item has been deleted. Please Contact Site Administrator")
             }

       
        generateRequestUniqueId();

      

        
       
    }

    function onQueryFailed_update(sender, args) {
        //$.hideLoader();
        $.showError(args.get_message() + '\n' + args.get_stackTrace());
    }
   
    
    // Getting the item type for the list
    function getListItemType(name) {
        return "SP.Data." + name[0].toUpperCase() + name.substring(1) + "ListItem";
    }

    
    function ViewFormEntry() {
        var requestUri = _spPageContextInfo.webAbsoluteUrl + "/_api/web/lists/getByTitle('" + listDisplayName + "')/items(" + querystring + ")?$select=ID,RequestFor,Requester/Id,Requester/Title,anager/Id,anager/Title,Request_x0020_Details,RequestId&$expand=Requester,anager";
        jQuery.ajax({
            url: requestUri,
            type: "GET",
            headers: { "accept": "application/json;odata=verbose" },
            success: function (data) {
                var div_lbl = $(data.d.Request_x0020_Details).text();
                $("#lbl_requestfor").val(data.d.RequestFor);
                $("#lbl_requesterID").val(data.d.Requester.Title);
                $("#lbl_managerID").val(data.d.anager.Title);
                $("#lbl_requestdetails").val(div_lbl);

                $("#lbl_requestID").val(data.d.RequestId);
               

                //getUserName(data.d.AccountManagerId, 'accountmanager');



            },
            error: function (err) {

                alert("Error Occured:" + JSON.stringify(err));

            }

        });
    }

   

    function generateRequestUniqueId() {
        $('#lblRequestUniqueId').html(getCombination() + "XXXXXXX");
    }

    function getRequestUniqueId() {
        var combination = getCombination();
        var number = "0000000RQ";
        //= "0000000" + getMaximumId();
        combination += number.substring(number.length - 7);
        return combination;
    }
    function getCombination() {
        var requestId = '';
        requestId += new Date().getFullYear().toString().substring(2);
        return requestId;
    }




</script>
